<!--
  ~ Copyright 2018, TeamDev Ltd. All rights reserved.
  ~
  ~ Redistribution and use in source and/or binary forms, with or without
  ~ modification, must retain the above copyright notice and the following
  ~ disclaimer.
  ~
  ~ THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  ~ "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  ~ LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  ~ A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  ~ OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  ~ SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  ~ LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  ~ DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  ~ THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  ~ (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  ~ OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  -->
<script src="../test_values.js"></script>
<link rel="import" href="../book/book-values.html">
<link rel="import" href="../actions/exlibris-actions.html">

<script>
    /*global userTestBooks libraryTestBooks expectedSoonLibraryBooks*/
    {
        const initialState = {
            overdueBooks: [...userTestBooks.overdue],
            borrowedBooks: [...userTestBooks.overdue, ...userTestBooks.borrowed],
            shouldReturnBooks: userTestBooks.shouldReturnSoon,
            reservedBooks: userTestBooks.reserved,
            allBooks: [...userTestBooks.overdue, ...libraryTestBooks],
            expectedSoonBooks: expectedSoonLibraryBooks,
            bookDetails: {
                book: {},
                loaded: false
            }
        };

        ExlibrisApp.reducer = (state = initialState, action) => {
            switch (action.type) {
                case ExlibrisApp.ExlibrisActions.FETCH_BOOKS: {
                    //TODO:2018-55-17:yurii.haidamaka add data loading from the server
                    return state;
                }
                case ExlibrisApp.ExlibrisActions.FIND_BOOK_BY_ID: {
                    const id = action.bookId;
                    const book = findElement(id, state.allBooks, state.expectedSoonBooks, state.borrowedBooks, state.reservedBooks);
                    if (book) {
                        return Object.assign({}, state, {
                            bookDetails: {
                                book: book,
                                loaded: true
                            }
                        });
                    }
                    return Object.assign({}, state, {
                        bookDetails: {
                            book: {},
                            loaded: false
                        }
                    });
                }

                case ExlibrisApp.ExlibrisActions.RESERVE_BOOK: {
                    //TODO:2018-21-18:yegor.udovchenko: request reservation
                    return state;
                }

                case ExlibrisApp.ExlibrisActions.CANCEL_BOOK_RESERVATION: {
                    //TODO:2018-21-18:yegor.udovchenko: request cancel reservation
                    return state;
                }

                case ExlibrisApp.ExlibrisActions.EXTEND_LOAN_PERIOD: {
                    //TODO:2018-22-18:yegor.udovchenko: request loan extension
                    return state;
                }

                default:
                    return state;
            }
        };

        function findElement(id) {
            let element;
            let i = 1;
            while (!element && i < arguments.length) {
                if (Array.isArray(arguments[i])) {
                    element = arguments[i].find(el => el.id === id);
                }
                i++;
            }
            return element;
        }
    }
</script>
